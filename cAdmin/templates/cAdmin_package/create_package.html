{% extends "cadmin_core/base.html" %}
{% load static %}

{% block breadcrumb %}
	<div class="header-body-left">

		<h3 class="page-title">ساخت پکیج جدید</h3>

		<!-- begin::breadcrumb -->
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="#">داشبورد</a></li>
				<li class="breadcrumb-item"><a href="{% url 'cadmin_packages' %}">پکیج ها</a></li>
				<li class="breadcrumb-item active" aria-current="page">پکیج جدید</li>
			</ol>
		</nav>
		<!-- end::breadcrumb -->

	</div>
{% endblock breadcrumb %}

{% block main %}
	<!-- begin::main content -->
	<main class="main-content">

		<div class="container-fluid">
			<form method="post" enctype="multipart/form-data">
				{% csrf_token %}
				<div class="row">
					<div class="col-md-6">
						<div class="card h-100">
							<div class="card-body">
								<h6 class="card-title">مشخصات پکیج</h6>
								<div class="form-group mb-5">
									<label for="color_name">نام رنگ</label>
									<input name="color_name" type="text" class="form-control text-left" id="color_name" aria-describedby="Productcolor_nameHelp" placeholder="نام رنگ" dir="ltr">
									<small id="Productcolor_nameHelp" class="form-text text-muted">نام رنگ را وارد کنید خیلی طولانی نباشد
									</small>
								</div>
                                <hr>
								<div class="form-group mt-5">
									<label for="price">قیمت محصول</label>
									<input name="price" type="text" class="form-control text-left" id="full_detail" aria-describedby="price" placeholder="قیمت محصول" dir="ltr">
									<small id="price" class="form-text text-muted">قیمت باید به تومان باشد
									</small>
								</div>
							</div>
						</div>
					</div>
                    <div class="col-md-6">
                        <div class="card h-100 text-light">
                            <div class="card-body d-flex flex-column align-items-center">
                                <h6 class="card-title">انتخاب رنگ</h6>

                                <!-- ردیف باکس رنگ + کالرپیکر -->
                                <div class="d-flex justify-content-center align-items-start gap-2 mt-3" style="width:100%; max-width:400px;">
                                    <!-- باکس رنگ انتخاب شده -->
                                    <div class="mr-3" id="colorPreviewBox" style="width:180px; height:180px; border-radius:5px; border:1px solid #666;"></div>

                                    <!-- کالرپیکر آزاد -->
                                    <div id="picker" style="width:180px; height:180px;"></div>
                                </div>

                                <!-- input HEX کامل در پایین -->
                                <div class="mt-3 w-100" style="max-width:400px;">
                                    <input type="text" id="colorHex" class="form-control text-light mt-5" placeholder="#FFFFFF">
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="color_hex" id="hiddenColor" value="#000000">
                    <div class="col-md-6">
                        <div class="card mt-3">
                            <div class="card-body">
                                <h6 class="card-title">شناسه محصول</h6>
                                <div class="form-group mb-3">
                                    <label for="product_pk">انتخاب محصول:</label>
                                    <select name="product_pk" id="product_pk" class="form-control" required>
                                        <option value="" disabled selected>----------</option>
                                        {% for product in products %}
                                        <option value="{{ product.0 }}">{{ product.1 }}</option>
                                        {% endfor %}
                                    </select>
                                    <small id="product_pk" class="form-text text-muted">شناسه این محصول را انتخاب کنید.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mt-3">
                            <div class="card-body">
                                <h6 class="card-title">تامین کننده محصول</h6>
                                <div class="form-group mb-3">
                                    <label for="supplier_pk">انتخاب تامین کننده:</label>
                                    <select name="supplier_pk" id="supplier_pk" class="form-control" required>
                                        <option value="" disabled selected>----------</option>
                                        {% for supplier in suppliers %}
                                        <option value="{{ supplier.0 }}">{{ supplier.1 }}</option>
                                        {% endfor %}
                                    </select>
                                    <small id="supplier_pk" class="form-text text-muted">تامین کننده این محصول را انتخاب کنید.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 mt-4">
						<div class="d-flex justify-content-start">
							<button type="submit" class="btn btn-success btn-block">ثبت پکیج جدید</button>
						</div>
					</div>
				</div>
			</form>
		</div>

	</main>
	<!-- end::main content -->
{% endblock main %}

{% block js %}

    <!-- color picker cdn -->
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>

    <!-- color picker -->
	<script>
        // ساخت کالرپیکر آزاد
        const colorPicker = new iro.ColorPicker("#picker", {
                width: 180,
                height: 180,
                layout: [
                    { component: iro.ui.Box },           // مربع Saturation/Lightness
                    { component: iro.ui.Slider, options:{ sliderType:'hue' } } // نوار Hue
                ],
                color: "#181b2e"
            });

            const colorHexInput = document.getElementById("colorHex");
            const hiddenColorInput = document.getElementById("hiddenColor");
            const colorPreviewBox = document.getElementById("colorPreviewBox");

            // وقتی رنگ از طریق کالرپیکر تغییر کرد
            colorPicker.on("color:change", function(color) {
                const hex = color.hexString.toUpperCase();
                colorHexInput.value = hex;
                hiddenColorInput.value = hex;
                colorPreviewBox.style.backgroundColor = hex;
            });

            // وقتی کاربر دستی HEX وارد می‌کند
            colorHexInput.addEventListener("input", function() {
                const val = colorHexInput.value.trim();
                if(/^#?[0-9A-Fa-f]{6}$/.test(val)) {
                    // ست کردن کالرپیکر، همیشه با # برای iro.js
                    colorPicker.color.hexString = val.startsWith("#") ? val : "#" + val;

                    // اما hidden input همان چیزی که کاربر وارد کرده را نگه می‌دارد
                    hiddenColorInput.value = val;

                    // نمایش در preview، اگر کاربر # نزده اضافه می‌کنیم فقط برای CSS
                    colorPreviewBox.style.backgroundColor = val.startsWith("#") ? val : "#" + val;
                }
        });

    </script>
{% endblock js %}